<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PicPay - Esqueci Minha Senha</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Cores do PicPay */
        :root {
            --picpay-green: #1abc9c;
            --picpay-dark-green: #16a085;
            --picpay-darker-green: #0d8b71;
            --picpay-black: #1a1a1a;
            --picpay-gray: #3a3a3a;
            --picpay-light-gray: #f5f5f5;
            --picpay-white: #ffffff;
            --picpay-yellow: #ffc107;
            --picpay-red: #dc3545;
            --shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            --radius: 12px;
            --transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background-color: var(--picpay-light-gray);
            color: var(--picpay-black);
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        /* Container Principal */
        .forgot-container {
            width: 100%;
            max-width: 450px;
            background-color: var(--picpay-white);
            border-radius: 25px;
            padding: 40px 35px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
            animation: slideUp 0.5s ease;
        }

        /* Header */
        .forgot-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background-color: var(--picpay-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(26, 188, 156, 0.3);
        }

        .logo-text {
            color: var(--picpay-green);
            font-size: 2rem;
            font-weight: 800;
            letter-spacing: -1px;
        }

        .forgot-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--picpay-black);
            margin-bottom: 10px;
        }

        .forgot-subtitle {
            color: var(--picpay-gray);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        /* Progress Steps */
        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            position: relative;
        }

        .progress-steps::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 20px;
            right: 20px;
            height: 3px;
            background-color: #e0e0e0;
            z-index: 1;
        }

        .progress-bar {
            position: absolute;
            top: 15px;
            left: 20px;
            height: 3px;
            background-color: var(--picpay-green);
            z-index: 2;
            transition: var(--transition);
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 3;
        }

        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: #e0e0e0;
            color: var(--picpay-gray);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 10px;
            transition: var(--transition);
            border: 3px solid white;
        }

        .step.active .step-circle {
            background-color: var(--picpay-green);
            color: white;
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(26, 188, 156, 0.3);
        }

        .step.completed .step-circle {
            background-color: var(--picpay-green);
            color: white;
        }

        .step.completed .step-circle::after {
            content: '✓';
        }

        .step-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--picpay-gray);
            text-align: center;
        }

        .step.active .step-label {
            color: var(--picpay-green);
        }

        /* Form Styles */
        .forgot-form {
            margin-bottom: 25px;
        }

        .form-step {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .form-step.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--picpay-black);
            font-size: 0.95rem;
        }

        .input-with-icon {
            position: relative;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px 16px 50px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            transition: var(--transition);
            background-color: #fafafa;
            color: var(--picpay-black);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--picpay-green);
            background-color: white;
            box-shadow: 0 0 0 3px rgba(26, 188, 156, 0.1);
        }

        .input-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--picpay-gray);
            font-size: 1.1rem;
        }

        /* Code Input */
        .code-container {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 10px;
        }

        .code-input {
            width: 60px;
            height: 60px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
            background-color: #fafafa;
            transition: var(--transition);
        }

        .code-input:focus {
            outline: none;
            border-color: var(--picpay-green);
            background-color: white;
            box-shadow: 0 0 0 3px rgba(26, 188, 156, 0.1);
        }

        .code-input.filled {
            border-color: var(--picpay-green);
            background-color: white;
        }

        /* Resend Code */
        .resend-container {
            text-align: center;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .resend-text {
            color: var(--picpay-gray);
            margin-bottom: 10px;
        }

        .resend-button {
            background: none;
            border: none;
            color: var(--picpay-green);
            font-weight: 700;
            cursor: pointer;
            font-size: 0.95rem;
            transition: var(--transition);
            padding: 5px 10px;
            border-radius: 6px;
        }

        .resend-button:hover:not(:disabled) {
            background-color: rgba(26, 188, 156, 0.1);
        }

        .resend-button:disabled {
            color: var(--picpay-gray);
            cursor: not-allowed;
        }

        /* Password Strength */
        .password-strength {
            margin-top: 10px;
        }

        .strength-bar {
            height: 6px;
            background-color: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .strength-fill {
            height: 100%;
            width: 0%;
            background-color: var(--picpay-red);
            transition: var(--transition);
        }

        .strength-text {
            font-size: 0.8rem;
            color: var(--picpay-gray);
        }

        .strength-fill.weak {
            width: 33%;
            background-color: var(--picpay-red);
        }

        .strength-fill.medium {
            width: 66%;
            background-color: var(--picpay-yellow);
        }

        .strength-fill.strong {
            width: 100%;
            background-color: var(--picpay-green);
        }

        /* Buttons */
        .form-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 16px;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background-color: var(--picpay-green);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: var(--picpay-dark-green);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 188, 156, 0.3);
        }

        .btn-primary:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: var(--picpay-black);
        }

        .btn-secondary:hover {
            background-color: #e0e0e0;
        }

        /* Error/Success Messages */
        .message {
            padding: 15px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            font-size: 0.9rem;
            display: none;
            align-items: center;
            gap: 10px;
            animation: slideDown 0.3s ease;
        }

        .error-message {
            background-color: rgba(220, 53, 69, 0.1);
            color: var(--picpay-red);
            border-left: 4px solid var(--picpay-red);
        }

        .success-message {
            background-color: rgba(26, 188, 156, 0.1);
            color: var(--picpay-green);
            border-left: 4px solid var(--picpay-green);
        }

        .info-message {
            background-color: rgba(13, 110, 253, 0.1);
            color: #0d6efd;
            border-left: 4px solid #0d6efd;
        }

        /* Login Link */
        .login-link {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: var(--picpay-gray);
            font-size: 0.9rem;
        }

        .login-link a {
            color: var(--picpay-green);
            text-decoration: none;
            font-weight: 700;
            margin-left: 5px;
        }

        .login-link a:hover {
            text-decoration: underline;
        }

        /* Animations */
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.5s ease;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .forgot-container {
                padding: 30px 20px;
            }
            
            .code-container {
                gap: 8px;
            }
            
            .code-input {
                width: 50px;
                height: 50px;
                font-size: 1.3rem;
            }
            
            .form-buttons {
                flex-direction: column;
            }
            
            .step-label {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <div class="forgot-container">
        <!-- Header -->
        <div class="forgot-header">
            <div class="logo-container">
                <div class="logo-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <div class="logo-text">PicPay</div>
            </div>
            <h1 class="forgot-title">Redefinir Senha</h1>
            <p class="forgot-subtitle">Siga os passos para recuperar o acesso à sua conta</p>
        </div>

        <!-- Progress Steps -->
        <div class="progress-steps">
            <div class="progress-bar" id="progress-bar"></div>
            
            <div class="step active" id="step-1">
                <div class="step-circle">1</div>
                <div class="step-label">CPF</div>
            </div>
            
            <div class="step" id="step-2">
                <div class="step-circle">2</div>
                <div class="step-label">Código</div>
            </div>
            
            <div class="step" id="step-3">
                <div class="step-circle">3</div>
                <div class="step-label">Nova Senha</div>
            </div>
        </div>

        <!-- Messages -->
        <div class="message error-message" id="error-message">
            <i class="fas fa-exclamation-circle"></i>
            <span id="error-text"></span>
        </div>
        
        <div class="message success-message" id="success-message">
            <i class="fas fa-check-circle"></i>
            <span id="success-text"></span>
        </div>
        
        <div class="message info-message" id="info-message">
            <i class="fas fa-info-circle"></i>
            <span id="info-text"></span>
        </div>

        <!-- Forms -->
        <form class="forgot-form" id="forgot-form">
            <!-- Step 1: CPF Verification -->
            <div class="form-step active" id="step1-form">
                <div class="form-group">
                    <label for="cpf" class="form-label">Digite seu CPF</label>
                    <div class="input-with-icon">
                        <i class="fas fa-user input-icon"></i>
                        <input type="text" id="cpf" class="form-input" placeholder="000.000.000-00" maxlength="14" required>
                    </div>
                    <p style="margin-top: 10px; font-size: 0.85rem; color: var(--picpay-gray);">
                        Digite o CPF da conta que deseja recuperar
                    </p>
                </div>
                
                <div class="form-buttons">
                    <button type="button" class="btn btn-secondary" id="cancel-btn">
                        <i class="fas fa-times"></i>
                        Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" id="next-step1">
                        Continuar
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>

            <!-- Step 2: Code Verification -->
            <div class="form-step" id="step2-form">
                <div class="form-group">
                    <label class="form-label">Código de verificação</label>
                    <p style="margin-bottom: 15px; font-size: 0.9rem; color: var(--picpay-gray);">
                        Enviamos um código de 6 dígitos para o e-mail/celular cadastrado no CPF:
                        <strong id="user-cpf-display"></strong>
                    </p>
                    
                    <div class="code-container">
                        <input type="text" class="code-input" maxlength="1" data-index="0" inputmode="numeric">
                        <input type="text" class="code-input" maxlength="1" data-index="1" inputmode="numeric">
                        <input type="text" class="code-input" maxlength="1" data-index="2" inputmode="numeric">
                        <input type="text" class="code-input" maxlength="1" data-index="3" inputmode="numeric">
                        <input type="text" class="code-input" maxlength="1" data-index="4" inputmode="numeric">
                        <input type="text" class="code-input" maxlength="1" data-index="5" inputmode="numeric">
                    </div>
                    
                    <input type="hidden" id="verification-code">
                    
                    <div class="resend-container">
                        <p class="resend-text">Não recebeu o código?</p>
                        <button type="button" class="resend-button" id="resend-code">
                            Reenviar código
                        </button>
                        <div id="countdown" style="display: none; margin-top: 5px; font-size: 0.85rem; color: var(--picpay-gray);">
                            Pode reenviar em <span id="countdown-timer">60</span> segundos
                        </div>
                    </div>
                </div>
                
                <div class="form-buttons">
                    <button type="button" class="btn btn-secondary" id="back-step2">
                        <i class="fas fa-arrow-left"></i>
                        Voltar
                    </button>
                    <button type="button" class="btn btn-primary" id="next-step2" disabled>
                        Verificar
                        <i class="fas fa-check"></i>
                    </button>
                </div>
            </div>

            <!-- Step 3: New Password -->
            <div class="form-step" id="step3-form">
                <div class="form-group">
                    <label for="new-password" class="form-label">Nova senha</label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" id="new-password" class="form-input" placeholder="Digite sua nova senha" required>
                        <button type="button" class="input-icon" style="left: auto; right: 18px; background: none; border: none; cursor: pointer;" id="toggle-password">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    
                    <div class="password-strength">
                        <div class="strength-bar">
                            <div class="strength-fill" id="strength-fill"></div>
                        </div>
                        <div class="strength-text" id="strength-text">Força da senha</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="confirm-password" class="form-label">Confirmar nova senha</label>
                    <div class="input-with-icon">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" id="confirm-password" class="form-input" placeholder="Digite novamente a nova senha" required>
                    </div>
                </div>
                
                <div class="form-buttons">
                    <button type="button" class="btn btn-secondary" id="back-step3">
                        <i class="fas fa-arrow-left"></i>
                        Voltar
                    </button>
                    <button type="button" class="btn btn-primary" id="reset-password" disabled>
                        Redefinir Senha
                        <i class="fas fa-key"></i>
                    </button>
                </div>
            </div>
        </form>

        <!-- Login Link -->
        <div class="login-link">
            Lembrou sua senha?
            <a href="index.html">Fazer login</a>
        </div>
    </div>

    <script>
        // ==============================================
        // DADOS DOS USUÁRIOS CADASTRADOS
        // ==============================================
        const registeredUsers = [
            {
                cpf: '49058911837',
                cpfFormatted: '490.589.118-37',
                name: 'Enzo Silva',
                password: '1814Enzo',
                email: 'enzo.silva@email.com',
                phone: '(11) 98765-4321'
            },
            {
                cpf: '11122233344',
                cpfFormatted: '111.222.333-44',
                name: 'Administrador',
                password: 'adm',
                email: 'admin@picpay.com',
                phone: '(11) 91234-5678'
            }
            // ADICIONE MAIS USUÁRIOS AQUI (OS MESMOS DO LOGIN)
        ];

        // Elementos DOM
        const steps = document.querySelectorAll('.step');
        const progressBar = document.getElementById('progress-bar');
        const formSteps = document.querySelectorAll('.form-step');
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        const successMessage = document.getElementById('success-message');
        const successText = document.getElementById('success-text');
        const infoMessage = document.getElementById('info-message');
        const infoText = document.getElementById('info-text');
        
        // Form Elements
        const cpfInput = document.getElementById('cpf');
        const userCpfDisplay = document.getElementById('user-cpf-display');
        const codeInputs = document.querySelectorAll('.code-input');
        const verificationCodeInput = document.getElementById('verification-code');
        const newPasswordInput = document.getElementById('new-password');
        const confirmPasswordInput = document.getElementById('confirm-password');
        const togglePasswordBtn = document.getElementById('toggle-password');
        const strengthFill = document.getElementById('strength-fill');
        const strengthText = document.getElementById('strength-text');
        
        // Buttons
        const cancelBtn = document.getElementById('cancel-btn');
        const nextStep1Btn = document.getElementById('next-step1');
        const backStep2Btn = document.getElementById('back-step2');
        const nextStep2Btn = document.getElementById('next-step2');
        const resendCodeBtn = document.getElementById('resend-code');
        const backStep3Btn = document.getElementById('back-step3');
        const resetPasswordBtn = document.getElementById('reset-password');
        
        // Variáveis do estado
        let currentStep = 1;
        let currentUser = null;
        let verificationCode = '';
        let canResendCode = true;
        let countdownInterval = null;

        // Inicialização
        function init() {
            updateProgressBar();
            setupEventListeners();
            formatCPFInput();
        }

        // Configurar event listeners
        function setupEventListeners() {
            // Navegação
            cancelBtn.addEventListener('click', goToLogin);
            nextStep1Btn.addEventListener('click', validateCPF);
            backStep2Btn.addEventListener('click', previousStep);
            nextStep2Btn.addEventListener('click', validateCode);
            resendCodeBtn.addEventListener('click', resendVerificationCode);
            backStep3Btn.addEventListener('click', previousStep);
            resetPasswordBtn.addEventListener('click', resetPassword);
            
            // Alternar visibilidade da senha
            togglePasswordBtn.addEventListener('click', togglePasswordVisibility);
            
            // Validação em tempo real
            newPasswordInput.addEventListener('input', validatePasswordStrength);
            confirmPasswordInput.addEventListener('input', validatePasswordMatch);
            
            // Código de verificação
            setupCodeInputs();
        }

        // Formatar CPF enquanto digita
        function formatCPFInput() {
            cpfInput.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                
                if (value.length > 3) {
                    value = value.substring(0, 3) + '.' + value.substring(3);
                }
                if (value.length > 7) {
                    value = value.substring(0, 7) + '.' + value.substring(7);
                }
                if (value.length > 11) {
                    value = value.substring(0, 11) + '-' + value.substring(11, 14);
                }
                
                e.target.value = value;
            });
        }

        // Configurar inputs do código
        function setupCodeInputs() {
            codeInputs.forEach((input, index) => {
                // Permitir apenas números
                input.addEventListener('input', function(e) {
                    this.value = this.value.replace(/\D/g, '');
                    
                    if (this.value.length === 1 && index < codeInputs.length - 1) {
                        codeInputs[index + 1].focus();
                    }
                    
                    updateCodeInputs();
                    validateCodeInputs();
                });
                
                // Navegação com teclas
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Backspace' && this.value === '' && index > 0) {
                        codeInputs[index - 1].focus();
                    }
                    if (e.key === 'ArrowLeft' && index > 0) {
                        codeInputs[index - 1].focus();
                    }
                    if (e.key === 'ArrowRight' && index < codeInputs.length - 1) {
                        codeInputs[index + 1].focus();
                    }
                });
                
                // Colar código completo
                input.addEventListener('paste', function(e) {
                    e.preventDefault();
                    const pastedData = e.clipboardData.getData('text').replace(/\D/g, '');
                    
                    if (pastedData.length === 6) {
                        for (let i = 0; i < 6; i++) {
                            if (codeInputs[i]) {
                                codeInputs[i].value = pastedData[i] || '';
                            }
                        }
                        codeInputs[5].focus();
                    }
                    
                    updateCodeInputs();
                    validateCodeInputs();
                });
            });
        }

        // Atualizar código dos inputs
        function updateCodeInputs() {
            let code = '';
            codeInputs.forEach(input => {
                code += input.value;
                if (input.value) {
                    input.classList.add('filled');
                } else {
                    input.classList.remove('filled');
                }
            });
            verificationCodeInput.value = code;
        }

        // Validar inputs do código
        function validateCodeInputs() {
            const code = verificationCodeInput.value;
            nextStep2Btn.disabled = code.length !== 6;
        }

        // Ir para o login
        function goToLogin() {
            window.location.href = 'index.html';
        }

        // Validar CPF
        function validateCPF() {
            const cpf = cpfInput.value.replace(/\D/g, '');
            
            // Validar formato
            if (cpf.length !== 11) {
                showError('Por favor, digite um CPF válido de 11 dígitos.');
                cpfInput.classList.add('shake');
                setTimeout(() => cpfInput.classList.remove('shake'), 500);
                return;
            }
            
            // Verificar se CPF existe
            const user = registeredUsers.find(u => u.cpf === cpf);
            if (!user) {
                showError('CPF não encontrado. Verifique se digitou corretamente.');
                cpfInput.classList.add('shake');
                setTimeout(() => cpfInput.classList.remove('shake'), 500);
                return;
            }
            
            // CPF válido, prosseguir
            currentUser = user;
            userCpfDisplay.textContent = user.cpfFormatted;
            generateVerificationCode();
            nextStep();
        }

        // Gerar código de verificação
        function generateVerificationCode() {
            // Gerar código de 6 dígitos
            verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
            console.log(`Código de verificação para ${currentUser.name}: ${verificationCode}`);
            
            // Mostrar mensagem informativa
            showInfo(`Enviamos um código de verificação de 6 dígitos para o e-mail/celular cadastrado no CPF ${currentUser.cpfFormatted}. Para testes, use o código: ${verificationCode}`);
            
            // Iniciar contador para reenvio
            startResendCountdown();
        }

        // Iniciar contador para reenvio
        function startResendCountdown() {
            canResendCode = false;
            resendCodeBtn.disabled = true;
            const countdownElement = document.getElementById('countdown');
            const countdownTimer = document.getElementById('countdown-timer');
            
            countdownElement.style.display = 'block';
            let seconds = 60;
            
            countdownInterval = setInterval(() => {
                seconds--;
                countdownTimer.textContent = seconds;
                
                if (seconds <= 0) {
                    clearInterval(countdownInterval);
                    canResendCode = true;
                    resendCodeBtn.disabled = false;
                    countdownElement.style.display = 'none';
                }
            }, 1000);
        }

        // Reenviar código
        function resendVerificationCode() {
            if (!canResendCode) return;
            
            generateVerificationCode();
            showSuccess('Novo código enviado com sucesso!');
            
            // Limpar inputs
            codeInputs.forEach(input => {
                input.value = '';
                input.classList.remove('filled');
            });
            verificationCodeInput.value = '';
            validateCodeInputs();
        }

        // Validar código
        function validateCode() {
            const enteredCode = verificationCodeInput.value;
            
            if (enteredCode.length !== 6) {
                showError('Digite o código completo de 6 dígitos.');
                codeInputs.forEach(input => {
                    if (!input.value) {
                        input.classList.add('shake');
                        setTimeout(() => input.classList.remove('shake'), 500);
                    }
                });
                return;
            }
            
            if (enteredCode !== verificationCode) {
                showError('Código incorreto. Verifique e tente novamente.');
                codeInputs.forEach(input => {
                    input.classList.add('shake');
                    setTimeout(() => input.classList.remove('shake'), 500);
                });
                return;
            }
            
            // Código válido
            clearInterval(countdownInterval);
            nextStep();
        }

        // Alternar visibilidade da senha
        function togglePasswordVisibility() {
            const type = newPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
            newPasswordInput.setAttribute('type', type);
            
            const icon = togglePasswordBtn.querySelector('i');
            icon.classList.toggle('fa-eye');
            icon.classList.toggle('fa-eye-slash');
        }

        // Validar força da senha
        function validatePasswordStrength() {
            const password = newPasswordInput.value;
            let strength = 0;
            let text = 'Digite uma senha';
            
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            
            // Atualizar barra de força
            strengthFill.className = 'strength-fill';
            
            if (password.length === 0) {
                text = 'Digite uma senha';
            } else if (strength <= 2) {
                strengthFill.classList.add('weak');
                text = 'Senha fraca';
            } else if (strength <= 4) {
                strengthFill.classList.add('medium');
                text = 'Senha média';
            } else {
                strengthFill.classList.add('strong');
                text = 'Senha forte';
            }
            
            strengthText.textContent = text;
            validatePasswordMatch();
        }

        // Validar se senhas coincidem
        function validatePasswordMatch() {
            const password = newPasswordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            
            if (password.length === 0) {
                resetPasswordBtn.disabled = true;
                return;
            }
            
            if (confirmPassword.length === 0) {
                resetPasswordBtn.disabled = true;
                return;
            }
            
            if (password !== confirmPassword) {
                resetPasswordBtn.disabled = true;
                confirmPasswordInput.style.borderColor = var('--picpay-red');
                return;
            }
            
            // Validar força mínima
            const passwordStrength = checkPasswordStrength(password);
            if (passwordStrength < 3) {
                resetPasswordBtn.disabled = true;
                return;
            }
            
            resetPasswordBtn.disabled = false;
            confirmPasswordInput.style.borderColor = '';
        }

        // Verificar força da senha
        function checkPasswordStrength(password) {
            let strength = 0;
            if (password.length >= 8) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            return strength;
        }

        // Redefinir senha
        function resetPassword() {
            const newPassword = newPasswordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            
            // Validações finais
            if (newPassword !== confirmPassword) {
                showError('As senhas não coincidem. Digite novamente.');
                confirmPasswordInput.classList.add('shake');
                setTimeout(() => confirmPasswordInput.classList.remove('shake'), 500);
                return;
            }
            
            if (checkPasswordStrength(newPassword) < 3) {
                showError('A senha é muito fraca. Use pelo menos 8 caracteres com letras maiúsculas, minúsculas e números.');
                return;
            }
            
            // Atualizar senha no array de usuários
            const userIndex = registeredUsers.findIndex(u => u.cpf === currentUser.cpf);
            if (userIndex !== -1) {
                registeredUsers[userIndex].password = newPassword;
                
                // Atualizar no LocalStorage (simulando)
                const userKey = `picpay_user_${currentUser.cpf}`;
                const savedData = localStorage.getItem(userKey);
                
                if (savedData) {
                    const userData = JSON.parse(savedData);
                    userData.password = newPassword;
                    userData.lastUpdate = new Date().toISOString();
                    localStorage.setItem(userKey, JSON.stringify(userData));
                }
                
                // Mostrar sucesso
                showSuccess('Senha redefinida com sucesso! Redirecionando para o login...');
                
                // Redirecionar após 3 segundos
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 3000);
            }
        }

        // Navegação entre passos
        function nextStep() {
            if (currentStep >= 3) return;
            
            // Atualizar estado atual
            steps[currentStep - 1].classList.remove('active');
            steps[currentStep - 1].classList.add('completed');
            
            currentStep++;
            
            steps[currentStep - 1].classList.add('active');
            updateProgressBar();
            
            // Mostrar formulário correspondente
            formSteps.forEach(step => step.classList.remove('active'));
            document.getElementById(`step${currentStep}-form`).classList.add('active');
            
            // Limpar mensagens
            hideMessages();
        }

        function previousStep() {
            if (currentStep <= 1) return;
            
            steps[currentStep - 1].classList.remove('active');
            currentStep--;
            steps[currentStep - 1].classList.add('active');
            updateProgressBar();
            
            formSteps.forEach(step => step.classList.remove('active'));
            document.getElementById(`step${currentStep}-form`).classList.add('active');
            
            hideMessages();
        }

        // Atualizar barra de progresso
        function updateProgressBar() {
            const width = ((currentStep - 1) / 2) * 100;
            progressBar.style.width = `${width}%`;
        }

        // Mostrar/esconder mensagens
        function showError(message) {
            hideMessages();
            errorText.textContent = message;
            errorMessage.style.display = 'flex';
        }

        function showSuccess(message) {
            hideMessages();
            successText.textContent = message;
            successMessage.style.display = 'flex';
        }

        function showInfo(message) {
            hideMessages();
            infoText.textContent = message;
            infoMessage.style.display = 'flex';
        }

        function hideMessages() {
            errorMessage.style.display = 'none';
            successMessage.style.display = 'none';
            infoMessage.style.display = 'none';
        }

        // Inicializar
        init();
    </script>
</body>
</html>
